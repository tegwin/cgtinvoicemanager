<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Invoice {{ invoice.invoice_number }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f3f4f6;
      color: #111827;
    }
    .page {
      max-width: 800px;
      margin: 2rem auto;
      background: #ffffff;
      padding: 2rem 2.5rem;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.15);
    }
    h1, h2, h3, h4 {
      margin: 0;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 2rem;
    }
    .brand-name {
      font-size: 1.4rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }
    .muted {
      color: #6b7280;
      font-size: 0.9rem;
    }
    .invoice-meta {
      text-align: right;
      font-size: 0.9rem;
    }
    .section-title {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }
    .box {
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 0.75rem 1rem;
      font-size: 0.9rem;
      margin-bottom: 1.5rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    th, td {
      border-bottom: 1px solid #e5e7eb;
      padding: 0.6rem 0.4rem;
      text-align: left;
    }
    th {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
    }
    .text-right {
      text-align: right;
    }
    .totals {
      margin-top: 1rem;
      width: 260px;
      margin-left: auto;
      font-size: 0.9rem;
    }
    .totals-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.25rem;
    }
    .totals-row.total {
      font-weight: 600;
      margin-top: 0.5rem;
      border-top: 1px solid #e5e7eb;
      padding-top: 0.4rem;
    }
    .notes {
      margin-top: 1.5rem;
      font-size: 0.9rem;
    }
    @media print {
      body {
        background: #ffffff;
      }
      .page {
        margin: 0;
        box-shadow: none;
      }
    }
  </style>
</head>
<body>
<div class="page">
  <div class="header">
    <div>
      <div class="brand-name">{{ settings.brand_name or "Invoice" }}</div>
      {% if settings.logo_url %}
        <div style="margin-top: 0.5rem;">
          <img src="{{ settings.logo_url }}" alt="Logo" style="max-height: 48px;">
        </div>
      {% endif %}
    </div>
    <div class="invoice-meta">
      <h2>Invoice</h2>
      <div>#{{ invoice.invoice_number }}</div>
      <div class="muted">Issued {{ invoice.issue_date }}</div>
      <div class="muted">Due {{ invoice.due_date }}</div>
      <div class="muted">Status: {{ invoice.status|capitalize }}</div>
    </div>
  </div>

  <div class="row" style="display: flex; gap: 1.5rem; margin-bottom: 1.5rem;">
    <div style="flex: 1;">
      <div class="section-title">Bill to</div>
      <div class="box">
        {% if invoice.customer %}
          <div><strong>{{ invoice.customer.name }}</strong></div>
          {% if invoice.customer.email %}
            <div>{{ invoice.customer.email }}</div>
          {% endif %}
          {% if invoice.customer.address_line1 %}
            <div>{{ invoice.customer.address_line1 }}</div>
          {% endif %}
          {% if invoice.customer.address_line2 %}
            <div>{{ invoice.customer.address_line2 }}</div>
          {% endif %}
          {% if invoice.customer.city or invoice.customer.postcode %}
            <div>
              {{ invoice.customer.city }} {{ invoice.customer.postcode }}
            </div>
          {% endif %}
          {% if invoice.customer.country %}
            <div>{{ invoice.customer.country }}</div>
          {% endif %}
        {% else %}
          <div class="muted">No customer attached to this invoice.</div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="section-title">Line items</div>
  <table>
    <thead>
      <tr>
        <th style="width: 30%;">Product</th>
        <th style="width: 40%;">Description</th>
        <th class="text-right" style="width: 10%;">Qty</th>
        <th class="text-right" style="width: 10%;">Unit</th>
        <th class="text-right" style="width: 10%;">Total</th>
      </tr>
    </thead>
    <tbody>
    {% if invoice.items %}
      {% for item in invoice.items %}
        <tr>
          <td>
            {% if item.product %}
              {{ item.product.name }}
            {% else %}
              Manual
            {% endif %}
          </td>
          <td>{{ item.description }}</td>
          <td class="text-right">{{ "%.2f"|format(item.quantity) }}</td>
          <td class="text-right">{{ "%.2f"|format(item.unit_price) }}</td>
          <td class="text-right">{{ "%.2f"|format(item.line_total) }}</td>
        </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="5" class="muted">No line items on this invoice.</td>
      </tr>
    {% endif %}
    </tbody>
  </table>

  <div class="totals">
    <div class="totals-row">
      <span>Subtotal</span>
      <span>{{ "%.2f"|format(invoice.subtotal_amount) }}</span>
    </div>
    <div class="totals-row">
      <span>VAT{% if invoice.tax_rate is not none %} ({{ "%.2f"|format(invoice.tax_rate) }}%){% endif %}</span>
      <span>{{ "%.2f"|format(invoice.tax_amount) }}</span>
    </div>
    <div class="totals-row total">
      <span>Total</span>
      <span>{{ "%.2f"|format(invoice.total_amount) }}</span>
    </div>
    <div class="totals-row">
      <span>Balance due</span>
      <span>{{ "%.2f"|format(invoice.balance_due) }}</span>
    </div>
  </div>

  {% if invoice.notes %}
    <div class="notes">
      <div class="section-title">Notes</div>
      <div>{{ invoice.notes }}</div>
    </div>
  {% endif %}
</div>
</body>
</html>
