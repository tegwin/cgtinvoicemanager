{% extends "base.html" %}
{% block content %}
<div class="page-header">
  <h1 class="page-title">Invoice {{ invoice.invoice_number }}</h1>
  <p class="page-subtitle">
    Detailed view including items and payment history.
  </p>
</div>

<div class="panel">
  <div class="panel-header">
    <div>
      <div class="panel-title">Summary</div>
      <div class="panel-subtitle">
        Customer: {{ invoice.customer.name }} Â· Status: {{ invoice.status }}
      </div>
    </div>
    <div>
      <a class="btn btn-secondary btn-sm"
         href="{{ url_for('edit_invoice', invoice_id=invoice.id) }}">Edit Invoice</a>
    </div>
  </div>

  <p><strong>Issue Date:</strong> {{ invoice.issue_date }}</p>
  <p><strong>Due Date:</strong> {{ invoice.due_date }}</p>

  <p><strong>Subtotal:</strong> {{ "%.2f"|format(invoice.subtotal_amount or 0) }}</p>
  <p><strong>Tax rate:</strong> {{ "%.2f"|format(invoice.tax_rate or 0) }} %</p>
  <p><strong>Tax amount:</strong> {{ "%.2f"|format(invoice.tax_amount or 0) }}</p>
  <p><strong>Total:</strong> {{ "%.2f"|format(invoice.total_amount) }}</p>
  <p><strong>Balance due:</strong> {{ "%.2f"|format(invoice.balance_due) }}</p>

  <p><strong>Notes:</strong><br>{{ invoice.notes }}</p>
</div>

<div class="panel">
  <div class="panel-header">
    <div class="panel-title">Items</div>
  </div>

  <table>
    <thead>
      <tr><th>Description</th><th>Qty</th><th>Unit price</th><th>Total</th></tr>
    </thead>
    <tbody>
      {% for item in invoice.items %}
        <tr>
          <td>{{ item.description }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ "%.2f"|format(item.unit_price) }}</td>
          <td>{{ "%.2f"|format(item.line_total) }}</td>
        </tr>
      {% else %}
        <tr><td colspan="4" class="text-muted">No items.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="panel">
  <div class="panel-header">
    <div class="panel-title">Payments</div>
  </div>

  <table>
    <thead>
      <tr><th>Date</th><th>Amount</th><th>Method</th><th>Reference</th></tr>
    </thead>
    <tbody>
      {% for p in invoice.payments %}
        <tr>
          <td>{{ p.payment_date }}</td>
          <td>{{ "%.2f"|format(p.amount) }}</td>
          <td>{{ p.method }}</td>
          <td>{{ p.external_reference }}</td>
        </tr>
      {% else %}
        <tr><td colspan="4" class="text-muted">No payments yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <h4 style="margin-top: 1.2rem;">Add payment</h4>
  <form method="post" action="{{ url_for('add_payment', invoice_id=invoice.id) }}">
    <div class="mb-3">
      <label class="form-label">Amount</label>
      <input type="number" step="0.01" name="amount" class="form-control" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Payment date</label>
      <input type="date" name="payment_date" class="form-control" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Method</label>
      <input name="method" class="form-control">
    </div>
    <div class="mb-3">
      <label class="form-label">External reference</label>
      <input name="external_reference" class="form-control">
    </div>
    <button class="btn btn-secondary">Add payment</button>
  </form>
</div>
{% endblock %}
