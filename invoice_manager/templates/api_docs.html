{% extends "base.html" %}

{% block content %}
<div class="row">
  <div class="col-lg-8">
    <div class="card-dark p-3 p-md-4 mb-3">
      <h2 class="mb-2">API Documentation</h2>
      <p class="text-muted-soft mb-3">
        Use this API to integrate the invoice system with your own tools and services.
        All requests must be authenticated with an API key.
      </p>

      <div class="alert-soft mb-3">
        <div class="fw-semibold mb-1">Authentication</div>
        <div class="small">
          Include your API key in the <code>X-API-Key</code> header:
        </div>
        <pre class="mt-2 mb-0 small"><code>GET /api/customers
X-API-Key: &lt;your-api-key&gt;</code></pre>
      </div>

      <h5 class="mt-3 mb-2">Base URL</h5>
      <pre class="small mb-3"><code>{{ request.host_url.rstrip('/') }}/api</code></pre>

      <hr class="my-3" style="border-color: rgba(148,163,184,0.4);">

      <!-- Customers -->
      <h4 class="mb-2">Customers</h4>
      <p class="text-muted-soft small mb-2">
        Create and manage your customers.
      </p>

      <div class="mb-3">
        <div class="badge badge-pill badge-soft-blue mb-1">GET /api/customers</div>
        <div class="small text-muted-soft mb-1">List customers</div>
        <pre class="small mb-2"><code>GET /api/customers</code></pre>
      </div>

      <div class="mb-3">
        <div class="badge badge-pill badge-soft-blue mb-1">GET /api/customers/&lt;id&gt;</div>
        <div class="small text-muted-soft mb-1">Get a single customer</div>
        <pre class="small mb-2"><code>GET /api/customers/1</code></pre>
      </div>

      <div class="mb-3">
        <div class="badge badge-pill badge-soft-green mb-1">POST /api/customers</div>
        <div class="small text-muted-soft mb-1">Create a new customer</div>
        <pre class="small mb-2"><code>POST /api/customers
Content-Type: application/json

{
  "name": "Acme Ltd",
  "email": "billing@acme.com",
  "address_line1": "123 High Street",
  "city": "London",
  "postcode": "SW1A 1AA",
  "country": "United Kingdom",
  "tax_rate": 20.0,
  "use_default_tax": true
}</code></pre>
      </div>

      <hr class="my-3" style="border-color: rgba(148,163,184,0.4);">

      <!-- Products -->
      <h4 class="mb-2">Products</h4>
      <p class="text-muted-soft small mb-2">
        Define reusable products and services that can be used on invoices.
      </p>

      <div class="mb-3">
        <div class="badge badge-pill badge-soft-blue mb-1">GET /api/products</div>
        <div class="small text-muted-soft mb-1">List products</div>
        <pre class="small mb-2"><code>GET /api/products</code></pre>
      </div>

      <div class="mb-3">
        <div class="badge badge-pill badge-soft-blue mb-1">GET /api/products/&lt;id&gt;</div>
        <div class="small text-muted-soft mb-1">Get a single product</div>
        <pre class="small mb-2"><code>GET /api/products/1</code></pre>
      </div>

      <div class="mb-3">
        <div class="badge badge-pill badge-soft-green mb-1">POST /api/products</div>
        <div class="small text-muted-soft mb-1">Create a new product</div>
        <pre class="small mb-2"><code>POST /api/products
Content-Type: application/json

{
  "name": "Consulting Day Rate",
  "description": "On-site consulting per day",
  "unit_price": 900.00,
  "active": true
}</code></pre>
      </div>

      <hr class="my-3" style="border-color: rgba(148,163,184,0.4);">

      <!-- Invoices -->
      <h4 class="mb-2">Invoices</h4>
      <p class="text-muted-soft small mb-2">
        Create invoices with line items and tax.
      </p>

      <div class="mb-3">
        <div class="badge badge-pill badge-soft-blue mb-1">GET /api/invoices</div>
        <div class="small text-muted-soft mb-1">List invoices</div>
        <pre class="small mb-2"><code>GET /api/invoices</code></pre>
      </div>

      <div class="mb-3">
        <div class="badge badge-pill badge-soft-blue mb-1">GET /api/invoices/&lt;id&gt;</div>
        <div class="small text-muted-soft mb-1">Get a single invoice</div>
        <pre class="small mb-2"><code>GET /api/invoices/8</code></pre>
      </div>

      <div class="mb-3">
        <div class="badge badge-pill badge-soft-green mb-1">POST /api/invoices</div>
        <div class="small text-muted-soft mb-1">Create a new invoice</div>
        <pre class="small mb-2"><code>POST /api/invoices
Content-Type: application/json

{
  "customer_id": 1,
  "issue_date": "2025-12-30",
  "due_date": "2026-01-14",
  "status": "draft",
  "tax_rate": 20.0,
  "items": [
    {
      "product_id": 1,
      "description": "Consulting day",
      "quantity": 3,
      "unit_price": 900.00
    }
  ]
}</code></pre>
      </div>

      <hr class="my-3" style="border-color: rgba(148,163,184,0.4);">

      <!-- Payments -->
      <h4 class="mb-2">Payments</h4>
      <p class="text-muted-soft small mb-2">
        Record payments against invoices.
      </p>

      <div class="mb-3">
        <div class="badge badge-pill badge-soft-blue mb-1">GET /api/payments</div>
        <div class="small text-muted-soft mb-1">List payments</div>
        <pre class="small mb-2"><code>GET /api/payments</code></pre>
      </div>

      <div class="mb-3">
        <div class="badge badge-pill badge-soft-blue mb-1">GET /api/payments/&lt;id&gt;</div>
        <div class="small text-muted-soft mb-1">Get a single payment</div>
        <pre class="small mb-2"><code>GET /api/payments/1</code></pre>
      </div>

      <div class="mb-3">
        <div class="badge badge-pill badge-soft-green mb-1">POST /api/payments</div>
        <div class="small text-muted-soft mb-1">Create a new payment</div>
        <pre class="small mb-0"><code>POST /api/payments
Content-Type: application/json

{
  "invoice_id": 8,
  "amount": 3240.00,
  "payment_date": "2026-01-05",
  "method": "Bank transfer",
  "reference": "INV-8-PAID"
}</code></pre>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="card-dark p-3 p-md-4">
      <h5 class="mb-2">Permissions</h5>
      <p class="text-muted-soft small mb-2">
        Each API key has separate <strong>read</strong> and <strong>write</strong> permissions.
      </p>
      <ul class="small text-muted-soft mb-3">
        <li>Read: can call <code>GET</code> endpoints.</li>
        <li>Write: can call <code>POST</code> endpoints.</li>
      </ul>

      <h6 class="mb-1">HTTP responses</h6>
      <ul class="small text-muted-soft mb-0">
        <li><code>200</code> – OK</li>
        <li><code>201</code> – Created</li>
        <li><code>400</code> – Validation error</li>
        <li><code>401</code> – Invalid or missing API key</li>
        <li><code>403</code> – Not enough permissions (e.g. write required)</li>
        <li><code>404</code> – Not found</li>
      </ul>
    </div>
  </div>
</div>
{% endblock %}
